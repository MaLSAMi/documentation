<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Distributor - MaLSAMi Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Distributor";
    var mkdocs_page_input_path = "data-generation/distributor.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> MaLSAMi Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Analysis</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../analysis/requirements-analysis/">Requirements Analysis</a>
                </li>
                <li class="">
                    
    <a class="" href="../../analysis/schedulability-analysis/">Schedulability Analysis</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Machine Learning</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../machine-learning/machine-learning/">Machine Learning</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../machine-learning/shallow-learning/">Shallow learning</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../machine-learning/deep-learning/">Deep Learning</a>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Networks</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../../machine-learning/nets/ffn/">Feed Forward Network</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../genode/genode/">Genode</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Data Generation</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Distributor</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#distributor">Distributor</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#set-up-and-configuration">Set up and Configuration</a></li>
        
            <li><a class="toctree-l4" href="#using-the-distributor">Using the Distributor</a></li>
        
            <li><a class="toctree-l4" href="#distributor-functions">Distributor functions</a></li>
        
            <li><a class="toctree-l4" href="#the-machine-class">The Machine class</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../monitor/">Monitor</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../concept.md">Concept</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../testbed.md">Testbed</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../about/">About</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">MaLSAMi Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Data Generation &raquo;</li>
        
      
    
    <li>Distributor</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="distributor">Distributor<a class="headerlink" href="#distributor" title="Permanent link">&para;</a></h1>
<p>Distributor is the main class/entity that controls and distributes host sessions to manage tasksets. Upon startup, the distributor will have a preset value of one host session that it will be able to spawn. The user is permitted to change this number at any time up to a hardcoded limit of forty one. Machines set to be closed will finish their assigned taskset before being shut down. The distributor is mainly used for gathering large-scale data about autonomous system schedulability-tasks, which can be used for data mining and analysis. </p>
<h2 id="set-up-and-configuration">Set up and Configuration<a class="headerlink" href="#set-up-and-configuration" title="Permanent link">&para;</a></h2>
<p>Clone the client-tools repository and initialize the submodules and place a working <a href="https://argos-research.github.io/documentation/">image.elf</a> file inside the client-tools directory.</p>
<h3 id="with-vagrant">With Vagrant<a class="headerlink" href="#with-vagrant" title="Permanent link">&para;</a></h3>
<p>A <strong>vagrant</strong> script is provided in the client-tools repository, which will set up the appropriate development environment and prepare it for use without any manual installation or configuration.</p>
<p>(Executing the distributor inside a vagrant machine leads to an unknown error, which stops the execution at some point after about ten to thirty hours. As the vagrant machine serves only as a test and development environment, this is not a critical issue and will not be further investigated, as mentioned in the according <a href="https://github.com/malsami/distributor_service/issues/9">issue</a>)</p>
<h3 id="manual-setup">Manual Setup<a class="headerlink" href="#manual-setup" title="Permanent link">&para;</a></h3>
<p>Install Python 3.5 and pip3</p>
<pre><code>sudo apt-get install python3.5 -qq
sudo apt-get  install python3-pip -qq
</code></pre>
<p>Install the requirements for the taskgen module</p>
<pre><code>sudo pip3 install -r client-tools/taskgen/requirements.txt
</code></pre>
<p>Install bridge functionality for networking:</p>
<pre><code>sudo apt-get install bridge-utils -qq
</code></pre>
<p>Download DHCP service and move provided configuration file. </p>
<pre><code>sudo apt-get install isc-dhcp-server -qq
sudo cp dhcpd.conf /etc/dhcp/
</code></pre>
<p>Set up the bridge and assign an IP address (consult the dhcp.conf file for more information on IP ranges)</p>
<pre><code>sudo brctl addbr br0
sudo ip addr add 10.200.40.1/21 dev br0
</code></pre>
<p>Adjust /etc/network/interfaces file with preliminary networking information</p>
<pre><code>sudo sh -c 'echo "auto br0\niface br0 inet dhcp\nbridge_ports eth0\nbridge_stp off\nbridge_maxwait 0\nbridge_fd 0\n" &gt;&gt; /etc/network/interfaces'
</code></pre>
<p>Install qemu and screen for spawning host sessions from the distributor and for easy visualization of spawned sessions. </p>
<pre><code>sudo apt-get install qemu -qq
sudo apt-get install screen -qq
</code></pre>
<p>Start the dhcp service</p>
<pre><code>sudo systemctl start isc-dhcp-server
</code></pre>
<p>The machine should now be ready for use. </p>
<h2 id="using-the-distributor">Using the Distributor<a class="headerlink" href="#using-the-distributor" title="Permanent link">&para;</a></h2>
<p>The following is an example execution to provide better understanding.</p>
<p><strong>Open up the interactive python shell</strong> in the directory &lsquo;distributor_service&rsquo; by typing (You can also create and execute this in a script)</p>
<pre><code>sudo python3
</code></pre>
<p><strong>Add appropriate imports:</strong> </p>
<p>(&lsquo;example.py&rsquo; holds some tasksets for testing, &lsquo;loggingMonitor.py&rsquo; is a <a href="../monitor/">Monitor</a> for testing, which writes to logs/monitor.log)</p>
<pre><code>from malsamiTest import example5
from monitors.loggingMonitor import LoggingMonitor
from distributor import Distributor
</code></pre>
<p>Defining a monitor and tasksets for the execution is left to the user.</p>
<p><strong>Initialize modules:</strong></p>
<pre><code>t = example5()
lm = LoggingMonitor()
dist = Distributor()
</code></pre>
<p>Now the distributor is running.</p>
<p><strong>Adding a job</strong> is possible via the add_jobs(taskset, monitor) function: </p>
<pre><code>dist.add_job(t,lm)
</code></pre>
<p>This will spawn machines acording to the current max_machine value.</p>
<p>Note: You can repeat the above command to queue multiple jobs whenever you please.</p>
<p>To view a list of detached qemu instances </p>
<pre><code>sudo screen -ls
</code></pre>
<p>To kill a detached screen type:</p>
<pre><code>sudo screen -X -S &lt;name\_of\_screen&gt; kill
</code></pre>
<p>The log files of the genode instances are also saved in the log/ directory.</p>
<p>Additionally, you can adjust the number of spawned machines, also while the distributor is running. See the distributor functions for more information. </p>
<h2 id="distributor-functions">Distributor functions<a class="headerlink" href="#distributor-functions" title="Permanent link">&para;</a></h2>
<p>Setting max machines to a value between 1 and 42. You can change this anytime as this only affects the maximum total number of spawned machines. If machines are active, the number will be adapted accordingly. Closing machines will still finish their current taskset before shutting down.</p>
<pre><code>    set_max_machine_value(numMachines)
</code></pre>
<p>Function to check if the distributor is busy or not. </p>
<pre><code>    get_distributor_state()
</code></pre>
<p>Return current maximum value of possible active machines</p>
<pre><code>    get_max_machine_value()
</code></pre>
<p>Creating a new job and adding it to a list of jobs to be worked on.
The function is instantiating a new object of type TaskSetQueue which is then appended to the list of jobs to be processed.</p>
<pre><code>    add_job(taskset, monitor, *session_parameters)
</code></pre>
<p>A job always consists of Taskset t and a Monitor, the session_parameters are optional. Inside the method a TaskSetQueue will hold the iterator which is returned by t.variants()</p>
<p>Kill all machines that are currently running </p>
<pre><code>    kill_all_machines()
</code></pre>
<h2 id="the-machine-class">The Machine class<a class="headerlink" href="#the-machine-class" title="Permanent link">&para;</a></h2>
<p>The &lsquo;machine.py&rsquo; implements a class which extends threading.Thread.</p>
<p>An instance of Machine is taking care of spawning a host, creating a session which connects to the spawned host and acquiring tasksets while there still is work to be done.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../monitor/" class="btn btn-neutral float-right" title="Monitor">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../genode/genode/" class="btn btn-neutral" title="Genode"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../genode/genode/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../monitor/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
